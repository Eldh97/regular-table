<!--
   
   Copyright (c) 2020, the Regular Table Authors.
   
   This file is part of the Regular Table library, distributed under the terms of
   the Apache License 2.0.  The full license can be found in the LICENSE file.

-->

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <script src="https://unpkg.com/@finos/perspective"></script>
    <script src="../umd/regular-table.js"></script>
    <link rel='stylesheet' href="../css/material.css">
</head>

<body>

    <regular-table></regular-table>

    <script>
        
        const URL = "https://unpkg.com/@jpmorganchase/perspective-examples/build/superstore.arrow";

        const datasource = async () => {
            const request = fetch(URL);
            const worker = perspective.worker();
            const response = await request;
            const buffer = await response.arrayBuffer();
            return worker.table(buffer);
        };
            
        window.addEventListener('DOMContentLoaded', async function () {
            const regular = document.getElementsByTagName('regular-table')[0];
            const table = await datasource();
            const view = table.view({row_pivots: ["State"]});
            const table_schema = await table.schema();
            await regular.set_view({
                num_rows: () => view.num_rows(),
                column_paths: () => view.column_paths(),
                get_config: () => view.get_config(),
                to_columns: (...args) => view.to_columns(...args),
                schema: () => view.schema().then(x => Object.assign(x, table_schema))
            });

            await regular.draw();
        });

    </script>

</body>

</html>